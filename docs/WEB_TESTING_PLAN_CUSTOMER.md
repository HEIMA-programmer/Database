# Customer 端功能测试方案

> 版本: 2.0
> 关联主文件: [WEB_TESTING_PLAN.md](WEB_TESTING_PLAN.md)
> 主线角色: Alice Fan (VIP, 1500积分)

---

## 目录

1. [用户注册测试](#1-用户注册测试)
2. [用户登录测试](#2-用户登录测试)
3. [Catalog商品目录测试](#3-catalog商品目录测试)
4. [Cart购物车测试](#4-cart购物车测试)
5. [Checkout结账测试](#5-checkout结账测试)
6. [Pay支付测试](#6-pay支付测试)
7. [Orders订单管理测试](#7-orders订单管理测试)
8. [Profile个人资料测试](#8-profile个人资料测试)
9. [会员积分与折扣测试](#9-会员积分与折扣测试)

---

## 1. 用户注册测试

**测试路径:** `/public/register.php`

### 1.1 注册表单元素

| 元素 | 类型 | 验证规则 |
|------|------|---------|
| Name | 文本 | 必填 |
| Email | 邮箱 | 必填，格式验证，唯一性 |
| Password | 密码 | 必填，最小长度 |
| Confirm Password | 密码 | 必须匹配 |
| Birthday | 日期 | 可选 |
| Register按钮 | 按钮 | 提交表单 |

### 1.2 成功注册测试

**测试用例 1.2.1: 新用户注册**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 访问注册页面 | 显示注册表单 |
| 2 | 填写Name: Test User | 输入成功 |
| 3 | 填写Email: test@new.com | 输入成功 |
| 4 | 填写Password: password123 | 输入成功 |
| 5 | 确认Password | 匹配成功 |
| 6 | 填写Birthday: 1990-06-15 | 输入成功 |
| 7 | 点击Register | 注册成功 |
| 8 | 验证跳转 | 跳转到登录页 |

**数据验证：**
- Customer表新增记录
- TierID默认为1(Standard)
- Points默认为0
- PasswordHash正确加密

### 1.3 注册验证测试

**测试用例 1.3.1: 邮箱重复**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 使用alice@test.com注册 | 显示错误 |
| 2 | 验证错误信息 | "Email already exists" |

**测试用例 1.3.2: 密码不匹配**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Password: abc123 | 输入 |
| 2 | Confirm: abc456 | 不匹配 |
| 3 | 提交 | 显示错误"Passwords do not match" |

**测试用例 1.3.3: 必填字段为空**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Name留空 | 提交失败 |
| 2 | Email留空 | 提交失败 |
| 3 | Password留空 | 提交失败 |

---

## 2. 用户登录测试

**测试路径:** `/public/login.php`

### 2.1 Alice登录测试 (主线)

**测试用例 2.1.1: Alice成功登录**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 访问登录页面 | 显示登录表单 |
| 2 | 输入Email: alice@test.com | 输入成功 |
| 3 | 输入Password: password123 | 输入成功 |
| 4 | 点击Login | 登录成功 |
| 5 | 验证跳转 | 跳转到Catalog页面 |
| 6 | 验证Session | 用户信息存储在Session |

### 2.2 登录失败测试

**测试用例 2.2.1: 错误密码**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Email: alice@test.com | 正确邮箱 |
| 2 | Password: wrongpassword | 错误密码 |
| 3 | 点击Login | 显示错误 |
| 4 | 验证消息 | "Invalid email or password" |

**测试用例 2.2.2: 不存在的用户**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Email: notexist@test.com | 不存在 |
| 2 | 点击Login | 显示错误 |

---

## 3. Catalog商品目录测试

**测试路径:** `/public/customer/catalog.php`

### 3.1 店铺选择器测试

| 店铺 | 类型 | 特点 |
|------|------|------|
| Changsha Flagship Store | Retail | 支持自提和配送 |
| Shanghai Branch | Retail | 支持自提和配送 |
| Online Warehouse | Warehouse | 仅支持配送 |

**测试用例 3.1.1: Alice切换店铺 (主线)**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Alice登录后访问Catalog | 默认显示某店铺库存 |
| 2 | 选择"Changsha Flagship Store" | 显示长沙店库存 |
| 3 | 验证显示专辑 | Abbey Road, Dark Side等 |
| 4 | 选择"Shanghai Branch" | 显示上海店库存 |
| 5 | 验证显示专辑 | Thriller, Kind of Blue等 |
| 6 | 选择"Online Warehouse" | 显示仓库库存 |
| 7 | 验证显示专辑 | Rumours, Led Zeppelin等 |

**测试用例 3.1.2: 店铺切换清空购物车**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 在长沙店添加商品到购物车 | 购物车有商品 |
| 2 | 切换到上海店 | 显示警告 |
| 3 | 验证警告信息 | "You changed store. Your cart has been cleared." |
| 4 | 确认切换 | 购物车清空 |

### 3.2 商品列表显示测试

**测试用例 3.2.1: 库存商品显示**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 查看长沙店Abbey Road | 显示商品卡片 |
| 2 | 验证价格范围 | ¥39.20 - ¥56.00 |
| 3 | 验证成色标签 | New, Mint, VG+ |
| 4 | 验证库存数量 | 4件可用 |

**测试用例 3.2.2: 无库存商品显示**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 查看无库存的专辑 | 灰色显示 |
| 2 | 验证标识 | 显示"Out of Stock" |
| 3 | 验证Add按钮 | 按钮禁用或不显示 |

### 3.3 搜索和筛选测试

**测试用例 3.3.1: 关键词搜索**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 在搜索框输入"Beatles" | 应用搜索 |
| 2 | 验证结果 | 只显示Abbey Road |
| 3 | 输入"Pink Floyd" | 应用搜索 |
| 4 | 验证结果 | 显示Dark Side, The Wall |

**测试用例 3.3.2: 流派筛选**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 选择流派"Rock" | 应用筛选 |
| 2 | 验证结果 | 只显示Rock类专辑 |
| 3 | 选择"Jazz" | 应用筛选 |
| 4 | 验证结果 | 只显示Kind of Blue |

**测试用例 3.3.3: 清除筛选**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 应用搜索和筛选 | 结果过滤 |
| 2 | 点击Reset/Clear | 清除条件 |
| 3 | 验证结果 | 恢复显示所有专辑 |

### 3.4 专辑详情页测试

**测试用例 3.4.1: 查看专辑详情**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 点击Abbey Road卡片 | 进入详情页 |
| 2 | 验证专辑信息 | 标题、艺术家、厂牌、年份 |
| 3 | 验证可用库存 | 按成色分组显示 |
| 4 | 验证价格 | New ¥56, Mint ¥53.20, VG+ ¥39.20 |

---

## 4. Cart购物车测试

**测试路径:** `/public/customer/cart.php`

### 4.1 Alice添加商品到购物车 (主线)

**测试用例 4.1.1: 添加单件商品**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 选择长沙店 | 店铺选择 |
| 2 | 进入Abbey Road详情 | 显示可用库存 |
| 3 | 选择Mint成色 | 成色选择 |
| 4 | 点击Add to Cart | 添加成功 |
| 5 | 验证购物车图标 | 显示数量1 |
| 6 | 验证成功消息 | "Added to cart" |

**测试用例 4.1.2: 添加多件不同商品**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 添加Abbey Road Mint | 购物车1件 |
| 2 | 添加Dark Side New | 购物车2件 |
| 3 | 添加Dark Side VG+ | 购物车3件 |
| 4 | 进入Cart页面 | 显示3件商品 |
| 5 | 验证小计 | ¥53.20+¥64+¥44.80=¥162 |

### 4.2 购物车页面显示

**显示内容：**
- 当前店铺名称
- 商品列表（专辑、成色、售价、数量）
- Remove按钮
- 小计金额
- 商品件数

### 4.3 购物车操作测试

**测试用例 4.3.1: 移除商品**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 购物车有3件商品 | 小计¥162 |
| 2 | 点击Dark Side New的Remove | 商品移除 |
| 3 | 验证购物车 | 剩余2件，¥98 |

**测试用例 4.3.2: 清空购物车**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 购物车有商品 | 有商品 |
| 2 | 点击Clear Cart | 确认对话框 |
| 3 | 确认清空 | 购物车为空 |

### 4.4 购物车按钮功能

| 按钮 | 功能 | 预期行为 |
|------|------|---------|
| Remove | 移除商品 | 删除该商品 |
| Clear Cart | 清空购物车 | 删除所有商品 |
| Continue Shopping | 继续购物 | 返回Catalog |
| Proceed to Checkout | 前往结账 | 跳转Checkout页面 |

---

## 5. Checkout结账测试

**测试路径:** `/public/customer/checkout.php`

### 5.1 结账页面显示

**显示内容：**
- 订单商品列表（只读）
- 客户信息（姓名、邮箱、会员等级）
- 履行选项（Pickup/Shipping）
- 价格计算明细
- Pay Now按钮

### 5.2 Alice结账流程 (主线)

**测试用例 5.2.1: 门店自提结账**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 购物车有长沙店商品¥53.20 | 进入Checkout |
| 2 | 验证客户信息 | Alice Fan, VIP |
| 3 | 选择Pickup（自提） | 选项选中 |
| 4 | 验证运费 | ¥0 (Free) |
| 5 | 验证折扣计算 | VIP 5%: -¥2.66 |
| 6 | 验证总计 | ¥53.20 - ¥2.66 = ¥50.54 |
| 7 | 点击Pay Now | 创建订单 |

**数据验证：**
- CustomerOrder创建：OrderStatus='Pending'
- FulfillmentType='Pickup'
- ShippingCost=0
- StockItem状态：Available → Reserved

**测试用例 5.2.2: 配送结账**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 选择Shipping（配送） | 选项选中 |
| 2 | 显示地址输入框 | 必填 |
| 3 | 输入配送地址 | 地址填写 |
| 4 | 验证运费 | ¥15 |
| 5 | 验证总计 | 商品-折扣+¥15 |

### 5.3 仓库订单限制

**测试用例 5.3.1: 仓库只能配送**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 购物车有仓库商品 | 进入Checkout |
| 2 | 验证履行选项 | 只显示Shipping |
| 3 | Pickup选项 | 不可用或不显示 |
| 4 | 提示信息 | "Warehouse orders can only be shipped" |

### 5.4 价格计算验证

**测试用例 5.4.1: VIP折扣计算**

| 项目 | 值 | 计算 |
|------|-----|------|
| 商品小计 | ¥100.00 | 原价 |
| VIP折扣(5%) | -¥5.00 | 100 × 0.05 |
| 折后小计 | ¥95.00 | 100 - 5 |
| 运费 | ¥15.00 | Shipping |
| 总计 | ¥110.00 | 95 + 15 |

**测试用例 5.4.2: Gold折扣计算**

| 项目 | 值 | 计算 |
|------|-----|------|
| 商品小计 | ¥100.00 | 原价 |
| Gold折扣(10%) | -¥10.00 | 100 × 0.10 |
| 折后小计 | ¥90.00 | 100 - 10 |
| 运费 | ¥0.00 | Pickup |
| 总计 | ¥90.00 | 90 + 0 |

---

## 6. Pay支付测试

**测试路径:** `/public/customer/pay.php`

### 6.1 支付页面显示

**显示内容：**
- 订单号
- 订单日期
- 商品明细（只读）
- 金额汇总
- 支付方式选择
- Confirm Payment按钮

### 6.2 Alice支付流程 (主线)

**测试用例 6.2.1: 成功支付**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 订单创建后跳转支付页 | 显示订单信息 |
| 2 | 验证订单号 | 正确显示 |
| 3 | 验证金额 | 与Checkout一致 |
| 4 | 点击Confirm Payment | 支付处理 |
| 5 | 验证成功消息 | "Payment successful" |
| 6 | 验证跳转 | 跳转订单详情 |

**数据验证：**
- OrderStatus: Pending → Paid
- StockItem保持Reserved状态

### 6.3 支付超时测试

**测试用例 6.3.1: 30分钟超时**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 创建订单但不支付 | OrderStatus=Pending |
| 2 | 等待30分钟(或触发定时任务) | 系统处理 |
| 3 | 验证订单状态 | OrderStatus=Cancelled |
| 4 | 验证库存状态 | Reserved → Available |
| 5 | 访问支付页面 | 显示"订单已取消" |

---

## 7. Orders订单管理测试

**测试路径:** `/public/customer/orders.php`

### 7.1 Alice订单列表 (主线)

**测试用例 7.1.1: 查看订单历史**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Alice登录 | 登录成功 |
| 2 | 访问My Orders | 显示订单列表 |
| 3 | 验证订单#1 | 60天前, InStore, ¥56.00, Completed |
| 4 | 验证订单#3 | 45天前, InStore, ¥40.00, Completed |
| 5 | 验证订单#6 | 20天前, Online, ¥51.20, Completed |

### 7.2 订单列表显示

**显示列：**
- 订单号(#XXXX)
- 日期
- 类型徽章(In-Store/Pickup/Delivery)
- 状态徽章(颜色区分)
- 金额
- Action按钮

**状态颜色：**
- Completed/Paid: 绿色
- Pending: 黄色
- Cancelled: 红色
- Shipped: 蓝色

### 7.3 订单操作测试

**测试用例 7.3.1: 查看订单详情**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 点击订单#1的View Details | 进入详情页 |
| 2 | 验证订单信息 | 订单号、日期、状态 |
| 3 | 验证商品列表 | Abbey Road New ¥56.00 |
| 4 | 验证店铺信息 | 长沙店地址 |

**测试用例 7.3.2: 取消未支付订单**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 创建新订单不支付 | OrderStatus=Pending |
| 2 | 在订单列表点击Cancel | 确认对话框 |
| 3 | 确认取消 | 订单取消 |
| 4 | 验证状态 | OrderStatus=Cancelled |
| 5 | 验证库存 | Reserved → Available |

**测试用例 7.3.3: 支付待付款订单**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 找到Pending订单 | 显示Pay按钮 |
| 2 | 点击Pay | 跳转支付页 |
| 3 | 完成支付 | 订单状态Paid |

### 7.4 订单详情页

**测试路径:** `/public/customer/order_detail.php`

**显示内容：**
- 订单基本信息
- 商品列表（专辑、艺术家、成色、数量、单价、小计）
- 发货信息（类型、地址、店铺）
- Back to Orders按钮

---

## 8. Profile个人资料测试

**测试路径:** `/public/customer/profile.php`

### 8.1 Alice资料显示 (主线)

**测试用例 8.1.1: 查看个人资料**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Alice登录后访问Profile | 显示资料页面 |
| 2 | 验证姓名 | Alice Fan |
| 3 | 验证邮箱 | alice@test.com |
| 4 | 验证等级 | VIP (显眼大字) |
| 5 | 验证折扣率 | 5% |
| 6 | 验证积分 | 1500 |
| 7 | 验证进度条 | 距Gold还需3500积分 |

### 8.2 会员卡展示

**显示内容：**
- 当前等级（大字显示）
- 折扣率百分比
- 当前积分（右上角）
- 下一等级进度条
- 距离下一等级所需积分

**进度条计算：**
```
VIP → Gold: 需要5000积分
当前: 1500积分
进度: 1500/5000 = 30%
还需: 3500积分
```

### 8.3 资料编辑测试

**测试用例 8.3.1: 修改姓名**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 点击Edit或进入编辑模式 | 表单可编辑 |
| 2 | 修改Name为"Alice Updated" | 输入新值 |
| 3 | 点击Update/Save | 保存成功 |
| 4 | 刷新页面 | 显示新姓名 |

**测试用例 8.3.2: 修改密码**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 输入新密码 | 密码框填写 |
| 2 | 确认新密码 | 匹配 |
| 3 | 点击Update | 保存成功 |
| 4 | 退出登录 | 登出 |
| 5 | 用新密码登录 | 登录成功 |

### 8.4 会员等级说明

**显示内容：**

| 等级 | 最低积分 | 折扣率 |
|------|---------|--------|
| Standard | 0 | 0% |
| VIP | 1000 | 5% |
| Gold | 5000 | 10% |

---

## 9. 会员积分与折扣测试

### 9.1 折扣应用测试

**测试用例 9.1.1: VIP折扣验证(Alice)**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Alice登录(VIP) | 登录成功 |
| 2 | 添加¥100商品到购物车 | 购物车¥100 |
| 3 | 进入Checkout | 显示折扣 |
| 4 | 验证折扣 | VIP 5%: -¥5.00 |
| 5 | 验证总计 | ¥95.00(+运费) |

**测试用例 9.1.2: Gold折扣验证(Bob)**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Bob登录(Gold) | 登录成功 |
| 2 | 添加¥100商品 | 购物车¥100 |
| 3 | 进入Checkout | 显示折扣 |
| 4 | 验证折扣 | Gold 10%: -¥10.00 |
| 5 | 验证总计 | ¥90.00(+运费) |

**测试用例 9.1.3: Standard无折扣(Charlie)**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Charlie登录(Standard) | 登录成功 |
| 2 | 添加¥100商品 | 购物车¥100 |
| 3 | 进入Checkout | 无折扣行 |
| 4 | 验证总计 | ¥100.00(+运费) |

### 9.2 积分累积测试

**测试用例 9.2.1: 购物积分累积**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Alice当前积分1500 | 记录初始值 |
| 2 | 完成¥100订单(折后¥95) | 订单Completed |
| 3 | 刷新Profile | 积分更新 |
| 4 | 验证新积分 | 1500 + 95 = 1595 |

**积分计算公式：**
```
积分增加 = floor(订单TotalAmount)
```

### 9.3 等级升级测试

**测试用例 9.3.1: Charlie升级到VIP**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Charlie当前: Standard, 150积分 | 初始状态 |
| 2 | 完成¥900订单 | 订单Completed |
| 3 | 验证积分 | 150 + 900 = 1050 |
| 4 | 验证等级 | **升级为VIP** |
| 5 | 再次购物 | 享受5%折扣 |

**测试用例 9.3.2: Alice升级到Gold**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Alice当前: VIP, 1500积分 | 初始状态 |
| 2 | 完成多笔订单累计¥3600 | 订单完成 |
| 3 | 验证积分 | 1500 + 3600 = 5100 |
| 4 | 验证等级 | **升级为Gold** |
| 5 | 再次购物 | 享受10%折扣 |

### 9.4 生日月份积分加成

**测试用例 9.4.1: Diana生日月购物**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | Diana生日12月23日 | 当前是12月 |
| 2 | 完成¥100订单 | 订单Completed |
| 3 | 验证积分增加 | 100 + 20(生日加成) = 120 |

**生日加成公式：**
```
如果当前月份 == 生日月份:
    积分增加 = floor(订单金额 × 1.2)
否则:
    积分增加 = floor(订单金额)
```

---

## 附录：Customer功能检查清单

### A. 注册登录检查

- [ ] 新用户注册成功
- [ ] 邮箱重复检测生效
- [ ] 密码验证生效
- [ ] 登录成功跳转正确
- [ ] 登录失败提示正确
- [ ] 登出功能正常

### B. 商品浏览检查

- [ ] 店铺切换功能正常
- [ ] 切换店铺清空购物车
- [ ] 搜索功能正常
- [ ] 流派筛选正常
- [ ] 商品详情显示正确
- [ ] 价格范围显示正确
- [ ] 库存数量显示正确

### C. 购物车检查

- [ ] 添加商品成功
- [ ] 移除商品成功
- [ ] 清空购物车成功
- [ ] 小计计算正确
- [ ] 不能添加其他店铺商品

### D. 结账支付检查

- [ ] VIP折扣5%计算正确
- [ ] Gold折扣10%计算正确
- [ ] 运费¥15(Shipping)正确
- [ ] 运费¥0(Pickup)正确
- [ ] 仓库只能Shipping
- [ ] 支付成功状态更新
- [ ] 超时订单自动取消

### E. 订单管理检查

- [ ] 订单列表显示正确
- [ ] 订单详情显示正确
- [ ] 取消未支付订单成功
- [ ] 支付待付款订单成功

### F. 会员积分检查

- [ ] 积分显示正确
- [ ] 等级显示正确
- [ ] 进度条显示正确
- [ ] 积分累积正确
- [ ] 等级自动升级
- [ ] 生日月份加成(如适用)

---

**文档结束**
